!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Service=e()}}(function(){return function(){return function e(t,i,r){function n(s,a){if(!i[s]){if(!t[s]){var o="function"==typeof require&&require;if(!a&&o)return o(s,!0);if(p)return p(s,!0);var d=new Error("Cannot find module '"+s+"'");throw d.code="MODULE_NOT_FOUND",d}var l=i[s]={exports:{}};t[s][0].call(l.exports,function(e){return n(t[s][1][e]||e)},l,l.exports,e,t,i,r)}return i[s].exports}for(var p="function"==typeof require&&require,s=0;s<r.length;s++)n(r[s]);return n}}()({1:[function(e,t,i){(function(i){"use strict";var r=e("fs"),{DBG:n,ERR:p,WARN:s,INFO:a}=global.getLogger(i),{PeripheralService:o,express:d,bodyParser:l}=global.getBundledModules();const{RELATIONSHIP_NONE:u,RELATIONSHIP_CONFIGURED:f,RELATIONSHIP_MANAGED:h}=o.relationships,{MODE_PIPE:c}=o.modes,y="abc";t.exports=class extends o{constructor(e,t,i){super(e,t,i),this.name="http",this.types=[y];try{var n=r.readFileSync("/tmp/p_types.txt").toString().split("\n");a(`tokens => ${JSON.stringify(n)}`),this.types=n}catch(e){}this.peripherals=[],this.peripheralMapping={},a(`name => ${this.name}`),a(`types => ${JSON.stringify(this.types)}`);var p=this;setInterval(()=>{p.check()},1e3)}init(e){return e()}fini(e){return e()}check(){let e=(new Date).getTime();var t=this,i=this.peripherals.filter(t=>e-t.updated_at>=1e3*t.timeout);i.length>0&&(this.peripherals=this.peripherals.filter(t=>e-t.updated_at<1e3*t.timeout),a(`found expired peripherals: ${i.length}`),i.forEach(e=>{var{key:i,p_type:r,p_id:n}=e;delete t.peripheralMapping[i],this.emitPeripheralState(r,n,f,{})}))}atRegistered(){a("the peripheral service is registered ...")}processWebCommand(e,t,i,r,n){if("emit-data"==t){var{p_type:p,p_id:s,s_type:o,s_id:d,timeout:l}=i;p=p||"abc",o=o||"xyz",s=s||"0",d=d||"0",l=(l="string"==typeof(l=l||60)?parseInt(l):l)<=0?60:l,delete i.p_type,delete i.s_type,delete i.p_id,delete i.s_id,delete i.timeout;let e=i;a(`emit-data: ${p}/${s}/${o}/${d} => timeout: ${l} => context: ${JSON.stringify(r)}, metadata => ${JSON.stringify(e)}`);let t=`${p}/${s}/${o}/${d}`;var u=this.peripheralMapping[t];let f=(new Date).getTime();return u?(this.emitData(p,s,o,d,r),u.updated_at=f):(u={p_type:p,p_id:s,s_type:o,s_id:d,timeout:l,key:t},this.peripherals.push(u),this.peripheralMapping[t]=u,this.emitPeripheralState(p,s,h,e),this.emitData(p,s,o,d,r),u.updated_at=f),n(null)}return n(null,`unsupported command: ${t}`)}}}).call(this,e("path").join(__dirname,"src","index.js"))},{fs:void 0,path:void 0}]},{},[1])(1)});