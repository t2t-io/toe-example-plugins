!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Service=e()}}(function(){return function(){return function e(t,n,i){function s(a,o){if(!n[a]){if(!t[a]){var p="function"==typeof require&&require;if(!o&&p)return p(a,!0);if(r)return r(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var u=n[a]={exports:{}};t[a][0].call(u.exports,function(e){return s(t[a][1][e]||e)},u,u.exports,e,t,n,i)}return n[a].exports}for(var r="function"==typeof require&&require,a=0;a<i.length;a++)s(i[a]);return s}}()({1:[function(e,t,n){t.exports={manifest:{format:2,name:"demo4",version:"0.0.1",created_at:"2019-09-11T15:31:30.178Z",checksum:"dc1357ac95f6b8a31326d65ed27576a56ce515fe750e8d728b53d005f8ac0c9f"},content:{peripheral_types:[{p_type:"schema_base_class",p_type_parent:null,class_name:"SchemaBaseClass",sensor_types:[]},{p_type:"nodejs_process",p_type_parent:"schema_base_class",class_name:"NodejsProcess",sensor_types:[{s_type:"cpu",s_identities:["0"],fields:[{name:"user",writeable:!1,value:{type:"int",range:[0,4294967296]},unit:"bytes",annotations:{}},{name:"system",writeable:!1,value:{type:"int",range:[0,4294967296]},unit:"bytes",annotations:{}}],actions:[]},{s_type:"memory",s_identities:["0"],fields:[{name:"rss",writeable:!1,value:{type:"int",range:[0,4294967296]},unit:"bytes",annotations:{}},{name:"heapTotal",writeable:!1,value:{type:"int",range:[0,4294967296]},unit:"bytes",annotations:{}},{name:"heapUsed",writeable:!1,value:{type:"int",range:[0,4294967296]},unit:"bytes",annotations:{}},{name:"external",writeable:!1,value:{type:"int",range:[0,4294967296]},unit:"bytes",annotations:{}}],actions:[]},{s_type:"os",s_identities:["current"],fields:[{name:"freeMemory",writeable:!1,value:{type:"int",range:[0,4294967296]},unit:"bytes",annotations:{}},{name:"uptime",writeable:!1,value:{type:"int",range:[0,4294967296]},unit:"seconds",annotations:{}},{name:"priority",writeable:!0,value:{type:"enum",range:["low","below_normal","normal","above_normal","high","highest"]},unit:"",annotations:{}}],actions:[]}]}]}}},{}],2:[function(e,t,n){(function(n){"use strict";var{DBG:i,ERR:s,WARN:r,INFO:a}=global.getLogger(n),{PeripheralService:o,express:p,bodyParser:l}=global.getBundledModules();const{RELATIONSHIP_NONE:u,RELATIONSHIP_CONFIGURED:d,RELATIONSHIP_MANAGED:c}=o.relationships,{MODE_PIPE:h}=o.modes,f="dcd",y=["low","below_normal","normal","above_normal","high","highest"];class m{constructor(e){this.parent=e,this.index=0}serialize(e,t,n,i){var s=Date.now().toString(),r=[this.index.toString(),s,e,t,n,JSON.stringify(i)].join("\t");return this.index=this.index+1,r}send(e,t,n,i){var s=this.serialize(e,t,n,i);return this.parent.emitPipeData(f,`${s}\n`)}sendAction(e,t,n,i){return this.send("actuator-action",e,t,{action:n,value:i})}}t.exports=class extends o{constructor(t,n,i){super(t,n,i,e("./schema.json")),this.pid=null,this.mode=h,this.mode_settings={pipes:[{name:f,byline:!0}]},this.sender=new m(this),a(`name => ${this.name}`),a(`types => ${JSON.stringify(this.types)}`),a(`schema => \n${JSON.stringify(this.schema)}`)}init(e){return e()}fini(e){return e()}atRegistered(){a("the peripheral service is registered ...")}atPipeEstablished(e,t){a(`${e}: pipe established => ${JSON.stringify(t)}`)}atPipeData(e,t,n=yes){if(n)if(t.startsWith("#"))a(`${e} <= ${t.gray}`);else{var i=null,s=t.split("\t"),[r,o,p,l,u,d]=s;if(o=new Date(parseInt(o)),"sensor-updated"==p?i=this.processPacket_sensor_updated:"peripheral-updated"==p&&(i=this.processPacket_peripheral_updated),!i)return a(`unknown event type: ${p}`),void a(`${e} <= ${t.gray}`);a(`${e} <- ${r.blue} ${o.toISOString()} ${p.yellow} ${l.cyan} ${u.green} ${d.red}`),i.apply(this,[l,u,d])}}processPacket_sensor_updated(e,t,n){var i=JSON.parse(n);if(this.pid&&this.emitData(this.types[0],this.pid,e,t,i),"os"==e){var{priority:s}=i,r=y[s];a(`${r} <= os/current, priority: ${s} (${r})`)}}processPacket_peripheral_updated(e,t,n){var i=JSON.parse(n);this.pid=e,this.ppid=t,this.emitPeripheralState(this.types[0],this.pid,c,i)}performAction(e,t,n,i,s,r,o,p,l){return a(`got actuator-request: ${e}/${t}/${n}/${i}/${s} => ${r}, ${o}, ${p}`),"os"==n&&"current"==i&&this.sender.sendAction(n,i,s,r),l()}}}).call(this,e("path").join(__dirname,"src","index.js"))},{"./schema.json":1,path:void 0}]},{},[2])(2)});