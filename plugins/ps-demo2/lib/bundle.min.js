!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Service=e()}}(function(){return function(){return function e(t,s,r){function i(n,o){if(!s[n]){if(!t[n]){var p="function"==typeof require&&require;if(!o&&p)return p(n,!0);if(a)return a(n,!0);var u=new Error("Cannot find module '"+n+"'");throw u.code="MODULE_NOT_FOUND",u}var c=s[n]={exports:{}};t[n][0].call(c.exports,function(e){return i(t[n][1][e]||e)},c,c.exports,e,t,s,r)}return s[n].exports}for(var a="function"==typeof require&&require,n=0;n<r.length;n++)i(r[n]);return i}}()({1:[function(e,t,s){t.exports={manifest:{format:2,created_at:"2018-10-11T19:19:03.293Z",name:"demo2",version:"0.0.1"},peripheral_types:[{p_type:"schema_base_class",p_type_parent:null,class_name:"SchemaBaseClass",sensor_types:[]},{p_type:"nodejs_process",p_type_parent:"schema_base_class",class_name:"NodejsProcess",sensor_types:[{s_type:"cpu",instances:[{s_id:"0",annotations:{}}],fields:[{name:"user",writeable:!1,value:{type:"int",range:[0,4294967296]},unit:"bytes",annotations:{}},{name:"system",writeable:!1,value:{type:"int",range:[0,4294967296]},unit:"bytes",annotations:{}}],actions:[]},{s_type:"memory",instances:[{s_id:"0",annotations:{}}],fields:[{name:"rss",writeable:!1,value:{type:"int",range:[0,4294967296]},unit:"bytes",annotations:{}},{name:"heapTotal",writeable:!1,value:{type:"int",range:[0,4294967296]},unit:"bytes",annotations:{}},{name:"heapUsed",writeable:!1,value:{type:"int",range:[0,4294967296]},unit:"bytes",annotations:{}},{name:"external",writeable:!1,value:{type:"int",range:[0,4294967296]},unit:"bytes",annotations:{}}],actions:[]}]}]}},{}],2:[function(e,t,s){(function(s){"use strict";var{DBG:r,ERR:i,WARN:a,INFO:n}=global.getLogger(s),{PeripheralService:o,express:p,bodyParser:u}=global.getBundledModules();const{RELATIONSHIP_NONE:c,RELATIONSHIP_CONFIGURED:l,RELATIONSHIP_MANAGED:m}=o.relationships;t.exports=class extends o{constructor(t,s,r){super(t,s,r,e("./schema.json")),this.pid=process.pid.toString(),this.monitors=[],n(`name => ${this.name}`),n(`types => ${JSON.stringify(this.types)}`),n(`schema => \n${JSON.stringify(this.schema)}`)}updatePeripheralState(){var t=e("os"),s={ppid:process.ppid,versions:process.versions,os_uptime:t.uptime(),os_platform:t.platform()};this.emitPeripheralState(this.types[0],this.pid,m,s)}processMonitorData(e,t,s){this.emitData(this.types[0],this.pid,e,t,s)}init(t){var s=new(e("./monitors/cpu"))(2e3);this.monitors.push(s);var r=new(e("./monitors/memory"))(1e4);this.monitors.push(r);var i=this;return this.monitors.forEach(e=>{n(`add data listener for monitors[${e.getName().yellow}]`),e.on("data-updated",(e,t,s)=>i.processMonitorData(e,t,s))}),t()}fini(e){return this.peripheralTimer&&(n("stop peripheral timer"),clearInterval(this.peripheralTimer)),this.monitors.forEach(e=>{n(`stop monitors[${e.getName().yellow}]`),e.stop()}),e()}atRegistered(){n("the peripheral service is registered ...");var e=this;this.updatePeripheralState(),this.peripheralTimer=setInterval(()=>{e.updatePeripheralState()},6e4),this.monitors.forEach(e=>{e.start()})}performAction(e,t,s,i,a,n,o,p,u){return r(`got actuator-request: ${e}/${t}/${s}/${i}/${a} => ${n}, ${o}, ${p}`),u()}}}).call(this,e("path").join(__dirname,"src","index.js"))},{"./monitors/cpu":4,"./monitors/memory":5,"./schema.json":1,os:void 0,path:void 0}],3:[function(e,t,s){"use strict";const r=e("events");t.exports=class extends r{constructor(e){super(),this.name="base",this.interval=e,this.timer=null}getName(){return this.name}start(){var e=this;this.capture(),this.timer=setInterval(()=>{e.capture()},this.interval)}stop(){this.timer&&clearInterval(this.timer)}capture(){}}},{events:void 0}],4:[function(e,t,s){"use strict";var r=e("./base");t.exports=class extends r{constructor(e){super(e),this.name="cpu"}start(){super.start(),this.startUsage=process.cpuUsage()}capture(){var e=process.cpuUsage(this.startUsage);this.emit("data-updated","cpu","0",e)}}},{"./base":3}],5:[function(e,t,s){"use strict";var r=e("./base");t.exports=class extends r{constructor(e){super(e),this.name="memory"}capture(){var e=process.memoryUsage();this.emit("data-updated","memory","0",e)}}},{"./base":3}]},{},[2])(2)});